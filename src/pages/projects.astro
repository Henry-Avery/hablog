---
import Layout from "../layouts/Layout.astro";
import {
	getAllTechStack,
	getFeaturedProjects,
	getProjectStats,
	getProjectsByCategory,
	projectsData,
} from "../data/projects";

// Get project statistics
const stats = getProjectStats();
const featuredProjects = getFeaturedProjects();
const allTechStack = getAllTechStack();

// Get all categories
const categories = [
	...new Set(projectsData.map((project) => project.category)),
];

// Get projects by category
const projectsByCategory = categories.reduce(
	(acc, category) => {
		acc[category] = getProjectsByCategory(category);
		return acc;
	},
	{} as Record<string, typeof projectsData>,
);

// Category text mapping
const getCategoryText = (category: string) => {
	switch (category) {
		case "web":
			return "Web Projects";
		case "mobile":
			return "Mobile Projects";
		case "desktop":
			return "Desktop Projects";
		case "other":
			return "Other Projects";
		default:
			return category;
	}
};

// Status text mapping
const getStatusText = (status: string) => {
	switch (status) {
		case "completed":
			return "Completed";
		case "in-progress":
			return "In Progress";
		case "planned":
			return "Planned";
		default:
			return status;
	}
};
---

<Layout title="Projects" description="My project showcase">
	<div class="container mx-auto px-4 py-16 max-w-6xl">
		<!-- Page Header -->
		<div class="mb-12">
			<h1 class="text-5xl font-bold mb-4">Projects</h1>
			<p class="text-lg opacity-70">
				A collection of my work and side projects
			</p>
		</div>

		<!-- Statistics -->
		<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-12">
			<div class="card bg-blue-500/10 border border-blue-500/20 shadow-sm">
				<div class="card-body p-6">
					<div class="text-3xl font-bold text-blue-600">{stats.total}</div>
					<div class="text-sm opacity-70">Total Projects</div>
				</div>
			</div>
			<div class="card bg-green-500/10 border border-green-500/20 shadow-sm">
				<div class="card-body p-6">
					<div class="text-3xl font-bold text-green-600">{stats.byStatus.completed}</div>
					<div class="text-sm opacity-70">Completed</div>
				</div>
			</div>
			<div class="card bg-yellow-500/10 border border-yellow-500/20 shadow-sm">
				<div class="card-body p-6">
					<div class="text-3xl font-bold text-yellow-600">{stats.byStatus.inProgress}</div>
					<div class="text-sm opacity-70">In Progress</div>
				</div>
			</div>
			<div class="card bg-purple-500/10 border border-purple-500/20 shadow-sm">
				<div class="card-body p-6">
					<div class="text-3xl font-bold text-purple-600">{allTechStack.length}</div>
					<div class="text-sm opacity-70">Technologies</div>
				</div>
			</div>
		</div>

		<!-- Featured Projects -->
		{featuredProjects.length > 0 && (
			<div class="mb-16">
				<h2 class="text-3xl font-bold mb-6">Featured Projects</h2>
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
					{featuredProjects.map((project) => (
						<div class="card bg-base-100 border border-base-300 shadow-xl hover:shadow-2xl transition-shadow duration-300">
							{project.image && (
								<figure class="aspect-video overflow-hidden">
									<img
										src={project.image}
										alt={project.title}
										class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
									/>
								</figure>
							)}
							<div class="card-body">
								<div class="flex items-start justify-between mb-3">
									<h3 class="card-title text-xl">
										{project.title}
									</h3>
									<span class={`badge ${
										project.status === 'completed'
											? 'badge-success'
											: project.status === 'in-progress'
											? 'badge-warning'
											: 'badge-ghost'
									}`}>
										{getStatusText(project.status)}
									</span>
								</div>
								<p class="opacity-70 mb-4">
									{project.description}
								</p>
								<div class="flex flex-wrap gap-2 mb-4">
									{project.techStack.slice(0, 4).map((tech) => (
										<span class="badge badge-primary badge-outline">
											{tech}
										</span>
									))}
									{project.techStack.length > 4 && (
										<span class="badge badge-ghost">
											+{project.techStack.length - 4}
										</span>
									)}
								</div>
								<div class="card-actions justify-start">
									{project.visitUrl && (
										<a
											href={project.visitUrl}
											target="_blank"
											rel="noopener noreferrer"
											class="btn btn-primary btn-sm"
										>
											Visit
										</a>
									)}
									{project.sourceCode && (
										<a
											href={project.sourceCode}
											target="_blank"
											rel="noopener noreferrer"
											class="btn btn-outline btn-sm"
										>
											GitHub
										</a>
									)}
								</div>
							</div>
						</div>
					))}
				</div>
			</div>
		)}

		<!-- Projects by Category -->
		<div class="space-y-12">
			{categories.map((category) => {
				const categoryProjects = projectsByCategory[category];
				if (categoryProjects.length === 0) return null;

				return (
					<div>
						<h2 class="text-3xl font-bold mb-6">
							{getCategoryText(category)}
							<span class="text-lg font-normal opacity-70 ml-2">
								({categoryProjects.length})
							</span>
						</h2>
						<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
							{categoryProjects.map((project) => (
								<div class="card bg-base-100 border border-base-300 shadow-lg hover:shadow-xl transition-shadow duration-300">
									{project.image && (
										<figure class="aspect-video overflow-hidden">
											<img
												src={project.image}
												alt={project.title}
												class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
											/>
										</figure>
									)}
									<div class="card-body p-5">
										<div class="flex items-start justify-between mb-2">
											<h3 class="card-title text-lg line-clamp-1">
												{project.title}
											</h3>
											<span class={`badge badge-sm ${
												project.status === 'completed'
													? 'badge-success'
													: project.status === 'in-progress'
													? 'badge-warning'
													: 'badge-ghost'
											}`}>
												{getStatusText(project.status)}
											</span>
										</div>
										<p class="opacity-70 text-sm line-clamp-2 mb-3">
											{project.description}
										</p>
										<div class="flex flex-wrap gap-1 mb-3">
											{project.techStack.slice(0, 3).map((tech) => (
												<span class="badge badge-sm badge-primary badge-outline">
													{tech}
												</span>
											))}
											{project.techStack.length > 3 && (
												<span class="badge badge-sm badge-ghost">
													+{project.techStack.length - 3}
												</span>
											)}
										</div>
										<div class="card-actions justify-start">
											{project.visitUrl && (
												<a
													href={project.visitUrl}
													target="_blank"
													rel="noopener noreferrer"
													class="btn btn-primary btn-xs"
												>
													Visit
												</a>
											)}
											{project.sourceCode && (
												<a
													href={project.sourceCode}
													target="_blank"
													rel="noopener noreferrer"
													class="btn btn-outline btn-xs"
												>
													GitHub
												</a>
											)}
										</div>
									</div>
								</div>
							))}
						</div>
					</div>
				);
			})}
		</div>

		<!-- Tech Stack -->
		<div class="mt-16 pt-8 border-t border-base-300">
			<h2 class="text-3xl font-bold mb-6">Tech Stack</h2>
			<div class="flex flex-wrap gap-3">
				{allTechStack.map((tech) => (
					<span class="badge badge-lg badge-ghost">
						{tech}
					</span>
				))}
			</div>
		</div>
	</div>
</Layout>

<style>
	.line-clamp-1 {
		display: -webkit-box;
		-webkit-line-clamp: 1;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
