---
import Layout from "../layouts/Layout.astro";
import {
	getAllTechStack,
	getTimelineByType,
	getTimelineStats,
	getTotalWorkExperience,
	getCurrentItems,
} from "../data/timeline";
import { formatDate } from "../utils/date-utils";

// Get timeline statistics
const stats = getTimelineStats();
const currentItems = getCurrentItems();
const workExperience = getTotalWorkExperience();

// Get all timeline items (sorted by date, newest first)
const allTimelineItems = getTimelineByType();

// Type text mapping
const getTypeText = (type: string) => {
	switch (type) {
		case "education":
			return "Education";
		case "work":
			return "Work";
		case "project":
			return "Project";
		case "achievement":
			return "Achievement";
		default:
			return type;
	}
};

// Calculate duration
const getDuration = (startDate: string, endDate?: string) => {
	const start = new Date(startDate);
	const end = endDate ? new Date(endDate) : new Date();
	const diffTime = Math.abs(end.getTime() - start.getTime());
	const diffMonths = Math.ceil(diffTime / (1000 * 60 * 60 * 24 * 30));

	if (diffMonths < 12) {
		return `${diffMonths} month${diffMonths !== 1 ? 's' : ''}`;
	}
	const years = Math.floor(diffMonths / 12);
	const months = diffMonths % 12;
	if (months === 0) {
		return `${years} year${years !== 1 ? 's' : ''}`;
	}
	return `${years} year${years !== 1 ? 's' : ''} ${months} month${months !== 1 ? 's' : ''}`;
};
---

<Layout title="Timeline" description="My journey and milestones">
	<div class="container mx-auto px-4 py-16 max-w-6xl">
		<!-- Page Header -->
		<div class="mb-12">
			<h1 class="text-5xl font-bold mb-4">Timeline</h1>
			<p class="text-lg opacity-70">
				A chronological view of my journey, experiences, and achievements
			</p>
		</div>

		<!-- Statistics -->
		<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
			<div class="card bg-blue-500/10 border border-blue-500/20 shadow-sm">
				<div class="card-body p-6">
					<div class="text-3xl font-bold text-blue-600">{stats.total}</div>
					<div class="text-sm opacity-70">Total Items</div>
				</div>
			</div>
			<div class="card bg-green-500/10 border border-green-500/20 shadow-sm">
				<div class="card-body p-6">
					<div class="text-3xl font-bold text-green-600">{stats.byType.work}</div>
					<div class="text-sm opacity-70">Work</div>
				</div>
			</div>
			<div class="card bg-purple-500/10 border border-purple-500/20 shadow-sm">
				<div class="card-body p-6">
					<div class="text-3xl font-bold text-purple-600">{stats.byType.project}</div>
					<div class="text-sm opacity-70">Projects</div>
				</div>
			</div>
			<div class="card bg-orange-500/10 border border-orange-500/20 shadow-sm">
				<div class="card-body p-6">
					<div class="text-3xl font-bold text-orange-600">
						{workExperience.years}+
					</div>
					<div class="text-sm opacity-70">Years Experience</div>
				</div>
			</div>
		</div>

		<!-- Current Items -->
		{currentItems.length > 0 && (
			<div class="mb-16">
				<h2 class="text-3xl font-bold mb-6 flex items-center">
					<span class="w-3 h-3 rounded-full bg-green-500 mr-3"></span>
					Currently
				</h2>
				<div class="space-y-6">
					{currentItems.map((item) => (
						<div class="card bg-base-100 border border-base-300 shadow-xl">
							<div class="card-body">
								<div class="flex items-start justify-between mb-3">
									<div>
										<h3 class="text-2xl font-bold">
											{item.title}
										</h3>
										{item.organization && (
											<div class="opacity-70 mt-1">
												{item.organization} {item.position && `â€¢ ${item.position}`}
											</div>
										)}
									</div>
									<span class="badge badge-success">Current</span>
								</div>

								{item.location && (
									<div class="flex items-center opacity-70 mb-3">
										<span class="mr-2">ğŸ“</span>
										<span>{item.location}</span>
									</div>
								)}

								<p class="opacity-80 mb-4">
									{item.description}
								</p>

								<div class="flex flex-wrap items-center gap-4 mb-4">
									<div class="text-sm opacity-70">
										<span class="font-medium">Started:</span> {formatDate(item.startDate)}
									</div>
									<div class="text-sm opacity-70">
										<span class="font-medium">Duration:</span> {getDuration(item.startDate)}
									</div>
								</div>

								{item.skills && item.skills.length > 0 && (
									<div class="flex flex-wrap gap-2 mb-4">
										{item.skills.map((skill) => (
											<span class="badge badge-primary badge-outline">
												{skill}
											</span>
										))}
									</div>
								)}

								{item.achievements && item.achievements.length > 0 && (
									<div class="mb-4">
										<h4 class="font-semibold mb-2">Achievements:</h4>
										<ul class="space-y-1">
											{item.achievements.map((achievement) => (
												<li class="flex items-start gap-2">
													<span class="text-green-500">â€¢</span>
													<span>{achievement}</span>
												</li>
											))}
										</ul>
									</div>
								)}

								{item.links && item.links.length > 0 && (
									<div class="flex flex-wrap gap-4">
										{item.links.map((link) => (
											<a
												href={link.url}
												target="_blank"
												rel="noopener noreferrer"
												class="link link-primary"
											>
												{link.type === 'certificate' && 'ğŸ†'}
												{link.type === 'project' && 'ğŸ”—'}
												{link.type === 'website' && 'ğŸŒ'}
												{link.name}
											</a>
										))}
									</div>
								)}
							</div>
						</div>
					))}
				</div>
			</div>
		)}

		<!-- Timeline History -->
		<div class="mb-12">
			<h2 class="text-3xl font-bold mb-8 flex items-center">
				<span class="w-3 h-3 rounded-full bg-purple-500 mr-3"></span>
				History
			</h2>

			<div class="relative">
				<!-- Timeline Line -->
				<div class="absolute left-8 top-0 bottom-0 w-0.5 bg-base-300"></div>

				<!-- Timeline Items -->
				<div class="space-y-8">
					{allTimelineItems.map((item) => (
						<div class="relative pl-20">
							<!-- Timeline Node -->
							<div
								class="absolute left-0 w-16 h-16 rounded-xl flex items-center justify-center text-white text-2xl font-bold"
								style={`background-color: ${item.color || '#7C3AED'}`}
							>
								{item.type === 'education' && 'ğŸ“'}
								{item.type === 'work' && 'ğŸ’¼'}
								{item.type === 'project' && 'âš¡'}
								{item.type === 'achievement' && 'ğŸ†'}
							</div>

							<!-- Content Card -->
							<div class="card bg-base-100 border border-base-300 shadow-lg hover:shadow-xl transition-shadow duration-300">
								<div class="card-body">
									<div class="flex items-start justify-between mb-3">
										<div>
											<h3 class="card-title">
												{item.title}
											</h3>
											{item.organization && (
												<div class="text-sm opacity-70 mt-1">
													{item.organization} {item.position && `â€¢ ${item.position}`}
												</div>
											)}
										</div>
										<span class={`badge ${
											item.type === 'education' ? 'badge-info' :
											item.type === 'work' ? 'badge-success' :
											item.type === 'project' ? 'badge-secondary' :
											'badge-warning'
										}`}>
											{getTypeText(item.type)}
										</span>
									</div>

									<div class="text-sm opacity-70 mb-3">
										{formatDate(item.startDate)} - {item.endDate ? formatDate(item.endDate) : 'Present'}
										<span class="mx-2">â€¢</span>
										{getDuration(item.startDate, item.endDate)}
										{item.location && (
											<>
												<span class="mx-2">â€¢</span>
												ğŸ“ {item.location}
											</>
										)}
									</div>

									<p class="opacity-80 mb-4">
										{item.description}
									</p>

									{item.achievements && item.achievements.length > 0 && (
										<div class="mb-4">
											<h4 class="font-semibold text-sm mb-2">Achievements:</h4>
											<ul class="space-y-1">
												{item.achievements.map((achievement) => (
													<li class="text-sm flex items-start gap-2">
														<span class="text-green-500">â€¢</span>
														<span>{achievement}</span>
													</li>
												))}
											</ul>
										</div>
									)}

									{item.skills && item.skills.length > 0 && (
										<div class="flex flex-wrap gap-2 mb-4">
											{item.skills.map((skill) => (
												<span class="badge badge-sm badge-ghost">
													{skill}
												</span>
											))}
										</div>
									)}

									{item.links && item.links.length > 0 && (
										<div class="flex flex-wrap gap-3">
											{item.links.map((link) => (
												<a
													href={link.url}
													target="_blank"
													rel="noopener noreferrer"
													class="link link-primary text-sm"
												>
													{link.type === 'certificate' && 'ğŸ†'}
													{link.type === 'project' && 'ğŸ”—'}
													{link.type === 'website' && 'ğŸŒ'}
													{link.name}
												</a>
											))}
										</div>
									)}
								</div>
							</div>
						</div>
					))}
				</div>
			</div>
		</div>
	</div>
</Layout>
